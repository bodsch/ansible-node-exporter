#jinja2: trim_blocks: True, lstrip_blocks: True
# {{ ansible_managed }}

{% set _enabled_collectors = [] %}
{% set _disabled_collectors = [] %}
{% if node_exporter_collectors is defined and
      node_exporter_collectors.enabled is defined %}
  {% set _enabled_collectors = node_exporter_collectors.enabled %}
{% endif %}
{% if node_exporter_collectors is defined and
      node_exporter_collectors.disabled is defined %}
  {% set _disabled_collectors = node_exporter_collectors.disabled %}
{% endif %}

GOMAXPROCS={{ ansible_processor_vcpus | default(ansible_processor_count) }}

OPTIONS="
{% for collector in _enabled_collectors -%}
{%   if collector | type == "dict" %}
{%     set name, options = (collector.items() | list)[0] -%}
  --collector.{{ name }} \
{%     for k,v in options | dictsort %}
  --collector.{{ name }}.{{ k }}={{ v | quote }} \
{%     endfor -%}
{%   else -%}
  --collector.{{ collector }} \
{%   endif -%}
{% endfor -%}
{% for collector in _disabled_collectors %}
  --no-collector.{{ collector }} \
{% endfor %}
"

#       --collector.bcache.priorityStats
#       --collector.cpu.guest      Enables metric node_cpu_guest_seconds_total
#       --collector.cpu.info       Enables metric cpu_info
#       --collector.cpu.info.flags-include=COLLECTOR.CPU.INFO.FLAGS-INCLUDE
#       --collector.cpu.info.bugs-include=COLLECTOR.CPU.INFO.BUGS-INCLUDE
#       --collector.diskstats.ignored-devices="^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\d+n\\d+p)\\d+$"
#       --collector.ethtool.device-include=COLLECTOR.ETHTOOL.DEVICE-INCLUDE
#       --collector.ethtool.device-exclude=COLLECTOR.ETHTOOL.DEVICE-EXCLUDE
#       --collector.ethtool.metrics-include=".*"
#       --collector.filesystem.mount-points-exclude="^/(dev|proc|run/credentials/.+|sys|var/lib/docker/.+)($|/)"
#                                  filesystem collector.
#       --collector.filesystem.fs-types-exclude="^(autofs|binfmt_misc|bpf|cgroup2?|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|iso9660|mqueue|nsfs|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|selinuxfs|squashfs|sysfs|tracefs)$"
#                                  filesystem collector.
#       --collector.ipvs.backend-labels="local_address,local_port,remote_address,remote_port,proto,local_mark"
#       --collector.netclass.ignored-devices="^$"
#                                  collector.
#       --collector.netclass.ignore-invalid-speed
#       --collector.netdev.device-include=COLLECTOR.NETDEV.DEVICE-INCLUDE
#       --collector.netdev.device-exclude=COLLECTOR.NETDEV.DEVICE-EXCLUDE
#       --collector.netdev.address-info
#       --collector.netstat.fields="^(.*_(InErrors|InErrs)|Ip_Forwarding|Ip(6|Ext)_(InOctets|OutOctets)|Icmp6?_(InMsgs|OutMsgs)|TcpExt_(Listen.*|Syncookies.*|TCPSynRetrans|TCPTimeouts)|Tcp_(ActiveOpens|InSegs|OutSegs|OutRsts|PassiveOpens|RetransSegs|CurrEstab)|Udp6?_(InDatagrams|OutDatagrams|NoPorts|RcvbufErrors|SndbufErrors))$"
#                                  collector.
#       --collector.ntp.server="127.0.0.1"
#                                  NTP server to use for ntp collector
#       --collector.ntp.protocol-version=4
#       --collector.ntp.server-is-local
#                                  Certify that collector.ntp.server address is
#       --collector.ntp.ip-ttl=1   IP TTL to use while sending NTP query
#       --collector.ntp.max-distance=3.46608s
#       --collector.ntp.local-offset-tolerance=1ms
#       --collector.perf.cpus=""   List of CPUs from which perf metrics should be
#       --collector.perf.tracepoint=COLLECTOR.PERF.TRACEPOINT ...
#       --collector.powersupply.ignored-supplies="^$"
#                                  powersupplyclass collector.
#       --collector.qdisc.fixtures=""
#                                  test fixtures to use for qdisc collector
#       --collector.runit.servicedir="/etc/service"
#       --collector.supervisord.url="http://localhost:9001/RPC2"
#       --collector.systemd.unit-include=".+"
#       --collector.systemd.unit-exclude=".+\\.(automount|device|mount|scope|slice)"
#       --collector.systemd.enable-task-metrics
#       --collector.systemd.enable-restarts-metrics
#       --collector.systemd.enable-start-time-metrics
#       --collector.tapestats.ignored-devices="^$"
#       --collector.textfile.directory=""
#       --collector.vmstat.fields="^(oom_kill|pgpg|pswp|pg.*fault).*"
#                                  collector.
#       --collector.wifi.fixtures=""
#                                  test fixtures to use for wifi collector metrics
#       --collector.arp            Enable the arp collector (default: enabled).
#       --collector.bcache         Enable the bcache collector (default: enabled).
#       --collector.bonding        Enable the bonding collector (default:
#       --collector.btrfs          Enable the btrfs collector (default: enabled).
#       --collector.buddyinfo      Enable the buddyinfo collector (default:
#       --collector.conntrack      Enable the conntrack collector (default:
#       --collector.cpu            Enable the cpu collector (default: enabled).
#       --collector.cpufreq        Enable the cpufreq collector (default:
#       --collector.diskstats      Enable the diskstats collector (default:
#       --collector.dmi            Enable the dmi collector (default: enabled).
#       --collector.drbd           Enable the drbd collector (default: disabled).
#       --collector.drm            Enable the drm collector (default: disabled).
#       --collector.edac           Enable the edac collector (default: enabled).
#       --collector.entropy        Enable the entropy collector (default:
#       --collector.ethtool        Enable the ethtool collector (default:
#       --collector.fibrechannel   Enable the fibrechannel collector (default:
#       --collector.filefd         Enable the filefd collector (default: enabled).
#       --collector.filesystem     Enable the filesystem collector (default:
#       --collector.hwmon          Enable the hwmon collector (default: enabled).
#       --collector.infiniband     Enable the infiniband collector (default:
#       --collector.interrupts     Enable the interrupts collector (default:
#       --collector.ipvs           Enable the ipvs collector (default: enabled).
#       --collector.ksmd           Enable the ksmd collector (default: disabled).
#       --collector.lnstat         Enable the lnstat collector (default:
#       --collector.loadavg        Enable the loadavg collector (default:
#       --collector.logind         Enable the logind collector (default:
#       --collector.mdadm          Enable the mdadm collector (default: enabled).
#       --collector.meminfo        Enable the meminfo collector (default:
#       --collector.meminfo_numa   Enable the meminfo_numa collector (default:
#       --collector.mountstats     Enable the mountstats collector (default:
#       --collector.netclass       Enable the netclass collector (default:
#       --collector.netdev         Enable the netdev collector (default: enabled).
#       --collector.netstat        Enable the netstat collector (default:
#       --collector.network_route  Enable the network_route collector (default:
#       --collector.nfs            Enable the nfs collector (default: enabled).
#       --collector.nfsd           Enable the nfsd collector (default: enabled).
#       --collector.ntp            Enable the ntp collector (default: disabled).
#       --collector.nvme           Enable the nvme collector (default: enabled).
#       --collector.os             Enable the os collector (default: enabled).
#       --collector.perf           Enable the perf collector (default: disabled).
#       --collector.powersupplyclass
#                                  Enable the powersupplyclass collector (default:
#       --collector.pressure       Enable the pressure collector (default:
#       --collector.processes      Enable the processes collector (default:
#       --collector.qdisc          Enable the qdisc collector (default: disabled).
#       --collector.rapl           Enable the rapl collector (default: enabled).
#       --collector.runit          Enable the runit collector (default: disabled).
#       --collector.schedstat      Enable the schedstat collector (default:
#       --collector.sockstat       Enable the sockstat collector (default:
#       --collector.softnet        Enable the softnet collector (default:
#       --collector.stat           Enable the stat collector (default: enabled).
#       --collector.supervisord    Enable the supervisord collector (default:
#       --collector.systemd        Enable the systemd collector (default:
#       --collector.tapestats      Enable the tapestats collector (default:
#       --collector.tcpstat        Enable the tcpstat collector (default:
#       --collector.textfile       Enable the textfile collector (default:
#       --collector.thermal_zone   Enable the thermal_zone collector (default:
#       --collector.time           Enable the time collector (default: enabled).
#       --collector.timex          Enable the timex collector (default: enabled).
#       --collector.udp_queues     Enable the udp_queues collector (default:
#       --collector.uname          Enable the uname collector (default: enabled).
#       --collector.vmstat         Enable the vmstat collector (default: enabled).
#       --collector.wifi           Enable the wifi collector (default: disabled).
#       --collector.xfs            Enable the xfs collector (default: enabled).
#       --collector.zfs            Enable the zfs collector (default: enabled).
#       --collector.zoneinfo       Enable the zoneinfo collector (default:
#       --collector.disable-defaults
